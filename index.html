<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Muslim App â€” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù…</title>
<meta name="description" content="Coran, Duas et Adhkar â€” Application islamique complÃ¨te"/>
<meta name="theme-color" content="#0a0d14"/>
<link rel="manifest" href="manifest.json"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="style.css"/>
<style>
.settings-section{max-width:500px;margin:0 auto;padding:0 20px 10px;}
.settings-card{background:var(--card);border:1px solid rgba(201,168,76,.15);border-radius:var(--radius);padding:20px;margin-bottom:16px;}
.settings-card-title{font-family:'Cinzel',serif;font-size:.8rem;color:var(--gold-light);letter-spacing:.1em;margin-bottom:14px;text-align:center;}
.settings-card .setting-group{margin-bottom:14px;}
.settings-card .setting-group:last-child{margin-bottom:0;}
.settings-card .setting-label{font-size:.72rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em;margin-bottom:6px;display:block;}
.settings-card .setting-select{width:100%;background:var(--deep);border:1px solid rgba(201,168,76,.2);border-radius:10px;padding:11px 12px;color:var(--white);font-size:.85rem;outline:none;appearance:none;cursor:pointer;}
.settings-card .setting-select:focus{border-color:var(--gold);}
.settings-card .setting-select option{background:var(--deep);color:var(--white);}
.test-reciter-wrap{display:flex;align-items:center;gap:10px;margin-top:10px;}
.test-btn{background:linear-gradient(135deg,rgba(201,168,76,.2),rgba(201,168,76,.08));border:1px solid rgba(201,168,76,.3);color:var(--gold);padding:8px 16px;border-radius:10px;font-size:.75rem;font-weight:600;display:flex;align-items:center;gap:6px;transition:all .2s;flex:1;justify-content:center;}
.test-btn:hover{background:linear-gradient(135deg,rgba(201,168,76,.35),rgba(201,168,76,.15));border-color:var(--gold);}
.test-btn.playing-test{background:rgba(74,222,128,.15);border-color:var(--green);color:var(--green);}
.test-btn.loading-test{background:rgba(201,168,76,.15);color:var(--gold-dim);}
.stop-btn{background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.15);color:var(--text-dim);padding:8px 14px;border-radius:10px;font-size:.75rem;transition:all .2s;}
.stop-btn:hover{color:var(--gold);border-color:var(--gold);}
.test-status{font-size:.68rem;color:var(--text-dim);text-align:center;margin-top:6px;min-height:16px;}
.reciter-preview{font-family:'Amiri',serif;font-size:.85rem;color:var(--gold);text-align:center;direction:rtl;padding:8px;background:rgba(201,168,76,.05);border-radius:8px;margin-top:8px;}
.section-divider{display:flex;align-items:center;gap:14px;max-width:500px;margin:10px auto 0;padding:0 20px;}
.section-divider span{font-family:'Cinzel',serif;font-size:.7rem;color:var(--text-dim);letter-spacing:.15em;text-transform:uppercase;white-space:nowrap;}
.section-divider::before,.section-divider::after{content:'';flex:1;height:1px;background:rgba(201,168,76,.12);}

/* LANG: Language toggle styles */
.lang-bar{display:flex;justify-content:center;align-items:center;gap:8px;padding:12px 16px;max-width:500px;margin:0 auto;}
.lang-bar-label{font-size:.72rem;color:var(--text-dim);letter-spacing:.1em;}
.lang-btn{padding:7px 20px;border:1px solid rgba(201,168,76,.25);border-radius:20px;background:transparent;color:var(--text-dim);font-size:.78rem;font-weight:600;cursor:pointer;transition:all .3s;font-family:inherit;}
.lang-btn:hover{border-color:var(--gold);color:var(--gold);}
.lang-btn.active{background:linear-gradient(135deg,rgba(201,168,76,.25),rgba(201,168,76,.08));border-color:var(--gold);color:var(--gold);box-shadow:0 2px 12px rgba(201,168,76,.15);}
.lang-options{display:flex;gap:10px;}
.lang-option{flex:1;padding:12px 10px;border:1px solid rgba(201,168,76,.2);border-radius:10px;background:var(--deep);color:var(--text-dim);font-size:.85rem;font-weight:600;cursor:pointer;transition:all .3s;text-align:center;font-family:inherit;}
.lang-option:hover{border-color:var(--gold);color:var(--gold);}
.lang-option.active{border-color:var(--gold);background:rgba(201,168,76,.1);color:var(--gold);}
</style>
</head>
<body>

<div class="bg-glow"></div>
<div class="bg-pattern">
  <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
    <defs><pattern id="geo" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
      <polygon points="20,2 38,11 38,29 20,38 2,29 2,11" fill="none" stroke="#c9a84c" stroke-width="0.5"/>
      <polygon points="20,8 32,14 32,26 20,32 8,26 8,14" fill="none" stroke="#c9a84c" stroke-width="0.3"/>
    </pattern></defs>
    <rect width="200" height="200" fill="url(#geo)"/>
  </svg>
</div>

<div class="toast" id="toast"></div>

<!-- LANG: Language toggle bar -->
<div class="lang-bar">
  <span class="lang-bar-label">ğŸŒ</span>
  <button class="lang-btn active" id="langFr" onclick="switchLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
  <button class="lang-btn" id="langWo" onclick="switchLang('wo')">ğŸ‡¸ğŸ‡³ Wolof</button>
</div>

<!-- HOME HERO -->
<div class="home-hero">
  <span class="moon-icon">ğŸŒ™</span>
  <div class="home-greeting" id="greeting"></div>
  <div class="home-title">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
  <div class="home-app-name">Muslim App</div>
  <!-- LANG: data-i18n added -->
  <div class="home-tagline" data-i18n="app_tagline">Coran Â· Invocations Â· Adhkar</div>
</div>

<!-- VERSE OF THE DAY -->
<div class="verse-of-day">
  <!-- LANG: data-i18n added -->
  <div class="verse-of-day-label" data-i18n="verse_of_day">âœ¦ Verset du jour âœ¦</div>
  <div class="verse-of-day-ar" id="vod-ar"></div>
  <div class="verse-of-day-tr" id="vod-tr"></div>
  <div class="verse-of-day-ref" id="vod-ref"></div>
</div>

<!-- FEATURE CARDS -->
<div class="features">
  <a href="quran.html" class="feature-card card-quran">
    <span class="feature-icon">ğŸ“–</span>
    <div class="feature-title-ar">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
    <!-- LANG: data-i18n added -->
    <div class="feature-title" data-i18n="card_quran_title">Le Coran</div>
    <div class="feature-desc" data-i18n="card_quran_desc">Lisez et Ã©coutez les 30 Juz et 114 Sourates</div>
  </a>
  <a href="duas.html" class="feature-card card-duas">
    <span class="feature-icon">ğŸ¤²</span>
    <div class="feature-title-ar">Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±</div>
    <!-- LANG: data-i18n added -->
    <div class="feature-title" data-i18n="card_duas_title">Invocations</div>
    <div class="feature-desc" data-i18n="card_duas_desc">Duas du matin, soir, priÃ¨re, repas...</div>
  </a>
  <a href="Dhikrs.html" class="feature-card card-adhkar">
    <span class="feature-icon">ğŸ“¿</span>
    <div class="feature-title-ar">Ø§Ù„Ø°ÙƒØ± ÙˆØ§Ù„ØªØ³Ø¨ÙŠØ­</div>
    <!-- LANG: data-i18n added -->
    <div class="feature-title" data-i18n="card_dhikr_title">Dhikr & Tasbih</div>
    <div class="feature-desc" data-i18n="card_dhikr_desc">Compteur de dhikr : SubhanAllah, Alhamdulillah...</div>
  </a>
  <div class="feature-card card-soon">
    <span class="feature-icon">ğŸ•Œ</span>
    <div class="feature-title-ar">Ø§Ù„Ù…Ø²ÙŠØ¯</div>
    <!-- LANG: data-i18n added -->
    <div class="feature-title" data-i18n="card_soon_title">BientÃ´t</div>
    <div class="feature-desc" data-i18n="card_soon_desc">Horaires de priÃ¨re, Tasbih, Qibla...</div>
    <span class="coming-badge">In Shaa Allah</span>
  </div>
</div>

<!-- SETTINGS -->
<!-- LANG: data-i18n added -->
<div class="section-divider"><span data-i18n="settings">âš™ï¸ ParamÃ¨tres</span></div>

<div class="settings-section">

  <!-- LANG: New language card -->
  <div class="settings-card">
    <div class="settings-card-title" data-i18n="settings_language">ğŸŒ Langue</div>
    <div class="setting-group">
      <div class="lang-options">
        <button class="lang-option active" id="setFr" onclick="switchLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
        <button class="lang-option" id="setWo" onclick="switchLang('wo')">ğŸ‡¸ğŸ‡³ Wolof</button>
      </div>
    </div>
  </div>

  <div class="settings-card">
    <!-- LANG: data-i18n added -->
    <div class="settings-card-title" data-i18n="settings_reciter">ğŸ™ï¸ RÃ©citateur</div>
    <div class="setting-group">
      <label class="setting-label" id="label-reciter">Choisir le rÃ©citateur</label>
      <select class="setting-select" id="select-reciter" onchange="onReciterChange(this.value)">
        <option value="ar.alafasy">Mishary Rashid Alafasy</option>
        <option value="ar.abdulbasitmurattal">Abdul Basit (Murattal)</option>
        <option value="ar.abdurrahmaansudais">Abdurrahman As-Sudais</option>
        <option value="ar.husary">Mahmoud Khalil Al-Husary</option>
        <option value="ar.minshawimujawwad">El-Minshawi (Mujawwad)</option>
        <option value="ar.hudhaify">Ali Al-Hudhaify</option>
        <option value="ar.muhammadayyoub">Muhammad Ayyoub</option>
        <option value="ar.muhammadjibreel">Muhammad Jibreel</option>
        <option value="ar.hanirifai">Hani Ar-Rifai</option>
        <option value="ar.ibrahimakhdar">Ibrahim Al-Akhdar</option>
      </select>
    </div>
    <div class="test-reciter-wrap">
      <button class="test-btn" id="test-btn" onclick="testReciter()">ğŸ”Š Tester le rÃ©citateur</button>
      <!-- LANG: data-i18n added -->
      <button class="stop-btn" onclick="stopTest()" data-i18n="test_stop">â¹ Stop</button>
    </div>
    <div class="test-status" id="test-status"></div>
    <div class="reciter-preview">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù Û Ù±Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ù±Ù„Ù’Ø¹ÙÙ°Ù„ÙÙ…ÙÙŠÙ†Ù</div>
  </div>

  <div class="settings-card">
    <!-- LANG: data-i18n added -->
    <div class="settings-card-title" data-i18n="settings_translation">ğŸŒ Traduction</div>
    <div class="setting-group">
      <label class="setting-label" id="label-translation">Langue de traduction</label>
      <select class="setting-select" id="select-translation" onchange="onTranslationChange(this.value)">
        <option value="fr.hamidullah">ğŸ‡«ğŸ‡· FranÃ§ais â€” Hamidullah</option>
        <option value="en.sahih">ğŸ‡¬ğŸ‡§ English â€” Sahih International</option>
        <option value="en.pickthall">ğŸ‡¬ğŸ‡§ English â€” Pickthall</option>
      </select>
    </div>
  </div>
</div>

<!-- STATS -->
<div class="home-stats">
  <!-- LANG: data-i18n added to all stat labels -->
  <div class="stat-item"><div class="stat-num" id="stat-juz">0</div><div class="stat-label" data-i18n="stat_juz_read">Juz lus</div></div>
  <div class="stat-item"><div class="stat-num">114</div><div class="stat-label" data-i18n="stat_surahs">Sourates</div></div>
  <div class="stat-item"><div class="stat-num">6236</div><div class="stat-label" data-i18n="stat_verses">Versets</div></div>
  <div class="stat-item"><div class="stat-num" id="stat-dhikr">0</div><div class="stat-label" data-i18n="stat_dhikr">Adhkar</div></div>
</div>

<footer>
  <div class="footer-dua">Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ ØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù’ Ù…ÙÙ†ÙÙ‘Ø§ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø£ÙÙ†ØªÙ Ø§Ù„Ø³ÙÙ‘Ù…ÙÙŠØ¹Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…Ù ğŸ¤²</div>
  <!-- LANG: wrapped Sadaqa Jariya in span with data-i18n -->
  <div class="footer-credit">Made with â¤ï¸ by <a href="https://github.com/lem2003" target="_blank">Mouhamadou</a> Â· <span data-i18n="footer_credit">Sadaqa Jariya</span></div>
</footer>

<audio id="test-audio" preload="none"></audio>

<!-- LANG: Load language system BEFORE main script -->
<script src="lang.js"></script>

<script>
/* ================================================
   DATA
   ================================================ */
var RECITER_NAMES = {
  'ar.alafasy':'Mishary Rashid Alafasy','ar.abdulbasitmurattal':'Abdul Basit (Murattal)',
  'ar.abdurrahmaansudais':'Abdurrahman As-Sudais','ar.husary':'Mahmoud Khalil Al-Husary',
  'ar.minshawimujawwad':'El-Minshawi (Mujawwad)','ar.hudhaify':'Ali Al-Hudhaify',
  'ar.muhammadayyoub':'Muhammad Ayyoub','ar.muhammadjibreel':'Muhammad Jibreel',
  'ar.hanirifai':'Hani Ar-Rifai','ar.ibrahimakhdar':'Ibrahim Al-Akhdar'
};

var VOD = [
  {ar:'ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ Ø£ÙØ¬ÙÙŠØ¨Ù Ø¯ÙØ¹Ù’ÙˆÙØ©Ù Ø§Ù„Ø¯ÙÙ‘Ø§Ø¹Ù Ø¥ÙØ°ÙØ§ Ø¯ÙØ¹ÙØ§Ù†Ù',fr:'Et quand Mes serviteurs t\'interrogent sur Moi, Je suis tout proche. Je rÃ©ponds Ã  l\'appel de celui qui M\'invoque.',ref:'Al-Baqarah 2:186'},
  {ar:'Ø¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§',fr:'Certes, avec la difficultÃ© il y a une facilitÃ©.',ref:'Ash-Sharh 94:6'},
  {ar:'ÙˆÙÙ…ÙÙ† ÙŠÙØªÙÙ‘Ù‚Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¬Ù’Ø¹ÙÙ„ Ù„ÙÙ‘Ù‡Ù Ù…ÙØ®Ù’Ø±ÙØ¬Ù‹Ø§ ÙˆÙÙŠÙØ±Ù’Ø²ÙÙ‚Ù’Ù‡Ù Ù…ÙÙ†Ù’ Ø­ÙÙŠÙ’Ø«Ù Ù„ÙØ§ ÙŠÙØ­Ù’ØªÙØ³ÙØ¨Ù',fr:'Et quiconque craint Allah, Il lui donnera une issue et lui accordera Ses dons d\'oÃ¹ il ne s\'y attend pas.',ref:'At-Talaq 65:2-3'},
  {ar:'ÙˆÙÙ„ÙØ³ÙÙˆÙ’ÙÙ ÙŠÙØ¹Ù’Ø·ÙÙŠÙƒÙ Ø±ÙØ¨ÙÙ‘ÙƒÙ ÙÙØªÙØ±Ù’Ø¶ÙÙ‰Ù°',fr:'Ton Seigneur t\'accordera certes Ses dons, et tu seras satisfait.',ref:'Ad-Duha 93:5'},
  {ar:'ÙÙØ§Ø°Ù’ÙƒÙØ±ÙÙˆÙ†ÙÙŠ Ø£ÙØ°Ù’ÙƒÙØ±Ù’ÙƒÙÙ…Ù’ ÙˆÙØ§Ø´Ù’ÙƒÙØ±ÙÙˆØ§ Ù„ÙÙŠ ÙˆÙÙ„ÙØ§ ØªÙÙƒÙ’ÙÙØ±ÙÙˆÙ†Ù',fr:'Souvenez-vous de Moi, Je Me souviendrai de vous.',ref:'Al-Baqarah 2:152'},
  {ar:'ÙˆÙÙ†ÙÙ†ÙØ²ÙÙ‘Ù„Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ù…ÙØ§ Ù‡ÙÙˆÙ Ø´ÙÙÙØ§Ø¡ÙŒ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©ÙŒ Ù„ÙÙ‘Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙŠÙ†Ù',fr:'Nous faisons descendre du Coran ce qui est guÃ©rison et misÃ©ricorde pour les croyants.',ref:'Al-Isra 17:82'},
  {ar:'Ù„ÙØ§ ÙŠÙÙƒÙÙ„ÙÙ‘ÙÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù†ÙÙÙ’Ø³Ù‹Ø§ Ø¥ÙÙ„ÙÙ‘Ø§ ÙˆÙØ³Ù’Ø¹ÙÙ‡ÙØ§',fr:'Allah n\'impose Ã  aucune Ã¢me une charge supÃ©rieure Ã  sa capacitÃ©.',ref:'Al-Baqarah 2:286'},
  {ar:'ÙˆÙÙ‚ÙÙ„ Ø±ÙÙ‘Ø¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§',fr:'Et dis : Seigneur, accrois mes connaissances.',ref:'Taha 20:114'},
  {ar:'Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙŠÙ†Ù',fr:'Certes, Allah est avec les patients.',ref:'Al-Baqarah 2:153'},
  {ar:'Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ù„ÙØ§ ØªÙØ¤ÙØ§Ø®ÙØ°Ù’Ù†ÙØ§ Ø¥ÙÙ† Ù†ÙÙ‘Ø³ÙÙŠÙ†ÙØ§ Ø£ÙÙˆÙ’ Ø£ÙØ®Ù’Ø·ÙØ£Ù’Ù†ÙØ§',fr:'Seigneur, ne nous chÃ¢tie pas si nous oublions ou commettons une erreur.',ref:'Al-Baqarah 2:286'},
];

/* ================================================
   LANG: Extend LANG with page-specific translations
   (keys not in lang.js â€” added here to keep lang.js clean)
   ================================================ */
LANG.settings_reciter    = {fr:'ğŸ™ï¸ RÃ©citateur',        wo:'ğŸ™ï¸ Kiy jÃ ng Alkuraan bi'};
LANG.settings_translation = {fr:'ğŸŒ Traduction',        wo:'ğŸŒ Tekki'};
LANG.settings_language   = {fr:'ğŸŒ Langue',             wo:'ğŸŒ LÃ kk'};
LANG.choose_reciter      = {fr:'Choisir le rÃ©citateur', wo:'TÃ nn kiy jÃ ng bi'};
LANG.translation_label   = {fr:'Langue de traduction',  wo:'LÃ kku tekki bi'};
LANG.test_reciter        = {fr:'ğŸ”Š Tester le rÃ©citateur', wo:'ğŸ”Š Siiwal kiy jÃ ng bi'};
LANG.test_stop           = {fr:'â¹ Stop',                wo:'â¹ Taxaw'};
LANG.test_loading_text   = {fr:'â³ Chargement...',       wo:'â³ Yaa ngi yab...'};
LANG.test_listening      = {fr:'ğŸ”Š En cours d\'Ã©coute...', wo:'ğŸ”Š Yaa ngi dÃ©glu...'};
LANG.test_done           = {fr:'âœ… Test terminÃ© â€” Al-Fatiha complÃ¨te !', wo:'âœ… Siiwal bi jeex na â€” Faatiha !'};
LANG.test_error          = {fr:'âš ï¸ Ce rÃ©citateur n\'est pas disponible', wo:'âš ï¸ Kiy jÃ ng bii amul'};
LANG.test_audio_error    = {fr:'âš ï¸ Erreur de lecture audio', wo:'âš ï¸ Njuumte ci audio bi'};
LANG.loading_fatiha      = {fr:'Chargement de Al-Fatiha...', wo:'Yaa ngi yab Suratul Faatiha...'};
LANG.playing_fatiha      = {fr:'â–¶ Al-Fatiha â€” Verset',  wo:'â–¶ Faatiha â€” Aaya'};

/* ================================================
   SETTINGS
   ================================================ */
function onReciterChange(val) {
  localStorage.setItem('q_rec', val);
  stopTest();
  showToast('ğŸ™ï¸ ' + RECITER_NAMES[val]);
}

function onTranslationChange(val) {
  localStorage.setItem('q_tr', val);
  var names = {'fr.hamidullah':'ğŸ‡«ğŸ‡· FranÃ§ais','en.sahih':'ğŸ‡¬ğŸ‡§ English (Sahih)','en.pickthall':'ğŸ‡¬ğŸ‡§ English (Pickthall)'};
  showToast('ğŸŒ ' + (names[val] || val));
}

/* ================================================
   RECITER TEST â€” LANG: uses t() for all messages
   ================================================ */
var testAudioEl = document.getElementById('test-audio');
var testAudioUrls = [];
var testIdx = 0;
var isTesting = false;

function testReciter() {
  var reciter = document.getElementById('select-reciter').value;
  stopTest();
  isTesting = true;
  testIdx = 0;

  var btn = document.getElementById('test-btn');
  btn.classList.add('loading-test');
  btn.innerHTML = t('test_loading_text');
  document.getElementById('test-status').textContent = t('loading_fatiha');

  fetch('https://api.alquran.cloud/v1/surah/1/' + reciter)
    .then(function(res) { return res.json(); })
    .then(function(json) {
      if (json.code !== 200) throw new Error('API error');
      testAudioUrls = json.data.ayahs.map(function(a) { return a.audio; });
      btn.classList.remove('loading-test');
      btn.classList.add('playing-test');
      btn.innerHTML = t('test_listening');
      document.getElementById('test-status').textContent = 'â–¶ Al-Fatiha â€” ' + RECITER_NAMES[reciter];
      playNextTest();
    })
    .catch(function() {
      document.getElementById('test-status').textContent = t('test_error');
      stopTest();
    });
}

function playNextTest() {
  if (!isTesting || testIdx >= testAudioUrls.length) {
    if (isTesting) {
      document.getElementById('test-status').textContent = t('test_done');
    }
    stopTest();
    return;
  }
  testAudioEl.src = testAudioUrls[testIdx];
  testAudioEl.play().then(function() {
    document.getElementById('test-status').textContent =
      t('playing_fatiha') + ' ' + (testIdx + 1) + '/7';
  }).catch(function() {
    document.getElementById('test-status').textContent = t('test_audio_error');
    stopTest();
  });
}

testAudioEl.addEventListener('ended', function() {
  testIdx++;
  playNextTest();
});

testAudioEl.addEventListener('error', function() {
  if (isTesting) {
    document.getElementById('test-status').textContent = t('test_error');
    stopTest();
  }
});

function stopTest() {
  isTesting = false;
  testAudioEl.pause();
  testAudioEl.removeAttribute('src');
  testAudioUrls = [];
  var btn = document.getElementById('test-btn');
  btn.classList.remove('playing-test');
  btn.classList.remove('loading-test');
  btn.innerHTML = t('test_reciter');
}

/* ================================================
   GREETING â€” LANG: supports FR and Wolof
   ================================================ */
function setGreeting() {
  var h = new Date().getHours();
  var lang = getCurrentLang();
  var g = '';
  if (lang === 'wo') {
    if (h >= 5 && h < 12)       g = 'ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± â€” JÃ mm nga fanaan';
    else if (h >= 12 && h < 17) g = 'â˜€ï¸ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± â€” JÃ mm nga yendoo';
    else if (h >= 17 && h < 21) g = 'ğŸŒ† Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± â€” JÃ mm nga yendoo';
    else                        g = 'ğŸŒ™ Ø·Ø§Ø¨Øª Ù„ÙŠÙ„ØªÙƒÙ… â€” Fanaanal jÃ mm';
  } else {
    if (h >= 5 && h < 12)       g = 'ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± â€” Bonjour';
    else if (h >= 12 && h < 17) g = 'â˜€ï¸ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± â€” Bon aprÃ¨s-midi';
    else if (h >= 17 && h < 21) g = 'ğŸŒ† Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± â€” Bonsoir';
    else                        g = 'ğŸŒ™ Ø·Ø§Ø¨Øª Ù„ÙŠÙ„ØªÙƒÙ… â€” Bonne nuit';
  }
  document.getElementById('greeting').textContent = g;
}

/* ================================================
   VOD / STATS / TOAST (inchangÃ©)
   ================================================ */
function setVerseOfDay() {
  var today = new Date().getDate() % VOD.length;
  var v = VOD[today];
  document.getElementById('vod-ar').textContent = v.ar;
  document.getElementById('vod-tr').textContent = v.fr;
  document.getElementById('vod-ref').textContent = 'â€” ' + v.ref + ' â€”';
}

function loadStats() {
  var done = JSON.parse(localStorage.getItem('q_done') || '[]');
  document.getElementById('stat-juz').textContent = done.length;
  var counters = JSON.parse(localStorage.getItem('q_counters') || '{}');
  var total = 0;
  var keys = Object.keys(counters);
  for (var i = 0; i < keys.length; i++) total += counters[keys[i]];
  document.getElementById('stat-dhikr').textContent = total;
}

function showToast(msg) {
  var el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(function() { el.classList.remove('show'); }, 3000);
}

/* ================================================
   LANG: Callback when language changes
   (called automatically by switchLang in lang.js)
   ================================================ */
function onLangChanged() {
  var lang = getCurrentLang();
  /* Update settings language buttons */
  var sf = document.getElementById('setFr');
  var sw = document.getElementById('setWo');
  if (sf) sf.classList.toggle('active', lang === 'fr');
  if (sw) sw.classList.toggle('active', lang === 'wo');
  /* Update greeting in new language */
  setGreeting();
  /* Update labels that use JS (not data-i18n) */
  document.getElementById('label-reciter').textContent = t('choose_reciter');
  document.getElementById('label-translation').textContent = t('translation_label');
  /* Update test button (only if not currently testing) */
  if (!isTesting) {
    document.getElementById('test-btn').innerHTML = t('test_reciter');
  }
}

/* ================================================
   INIT
   ================================================ */
(function() {
  document.getElementById('select-reciter').value = localStorage.getItem('q_rec') || 'ar.alafasy';
  document.getElementById('select-translation').value = localStorage.getItem('q_tr') || 'fr.hamidullah';
  setGreeting();
  setVerseOfDay();
  loadStats();
  refreshLang(); /* LANG: Apply saved language on load */
})();

if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(function(){});
</script>
</body>
</html>